<!--
  (c) copyright CGSG summer practice 2021
  web paint by AC1 and FB4
-->

<html>
<head>
  <title>OPIE - Online Paint Image Editor</title>
  <!--  <link rel="stylesheet" type="text/css" href="index.css"-->
</head>

<body>
  <div id="container">
    <canvas id='Plane' style="border:1px solid #d3d3d3;"  onmousedown="mouseDown(event)" onmouseup="mouseUp()" 
        onmousemove="mouseMove(event)" onmousewheel="mouseWheel(event)"></canvas>
    <menu id="controls">
      <button onclick="Color1()">Black</button>
      <button onclick="Color2()">White</button>
      <button onclick="Color3()">Green</button>
      <button onclick="Color4()">Red</button>
      <button onclick="Color5()">Blue</button>
      <button onclick="Color6()">Yellow</button>
      <button onclick="Color7()">Brown</button> 
      <input type="range" min="1" max="100" step="1" value="1" id="Width">  
    </menu>
  </div> 
  <!--<canvas id="Plane" border-radius="50px" outline-color="grey" top="0" bottom="100" right="0" left="0"></canvas>-->
  <!--
    <button>Buffer Draw</button>
  -->
  <script>
  	let canvas = document.getElementById("Plane");
		let ctx = canvas.getContext('2d');
    let isdrawing = false;
    let wigth = 1;
    let basedeltaX = 0, basedeltaY = 0; 

    /* draw circle function */
    function drawCircle(ctx, x, y, radius, fill, stroke, strokeWidth) {
      ctx.beginPath()
      ctx.arc(x, y, radius, 0, 2 * Math.PI, false)
      if (fill) {
        ctx.fillStyle = fill;
        ctx.fill();
      }
      if (stroke) {
        ctx.lineWidth = strokeWidth;
        ctx.strokeStyle = stroke;
        ctx.stroke();
      }
    } 

    /* mouceDown canvas function */
    function mouseDown(event) {
      var x = event.pageX - event.target.offsetLeft,
        y = event.pageY - event.target.offsetTop;
      ctx.lineWidth = parseInt(document.getElementById("Width").value);
      if (event.button == 0) {
        ctx.beginPath()
        isdrawing = true;
        ctx.moveTo(x, y);
     }
    }

    canvas.width = document.documentElement.clientWidth;
    canvas.height = document.documentElement.clientHeight;
  </script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    let socket = io();
    let globW = ctx.canvas.clientWidth;
    let globH = ctx.canvas.clientHeight;
    var imgData = ctx.getImageData(0, 0, globW, globH);
    let globX = 0, globY = 0;
    let globColor;


    /* mouceUp function */
    const numberToHex = number => {
      const HEX = 16;
      return Number(number).toString(HEX).toUpperCase()
    }
    function mouseUp() {
    if (isdrawing && event.button == 0) {
        ctx.closePath();
        isdrawing = false;
      }
    }

    function SetPixel()


    function line(x0, y0, x1, y1) {
      var dx = Math.abs(x1 - x0);
      var dy = Math.abs(y1 - y0);
      var sx = (x0 < x1) ? 1 : -1;
      var sy = (y0 < y1) ? 1 : -1;
      var err = dx - dy;
      while(true) {
          setPixel(x0, y0); // Do what you need to for this
          if ((x0 === x1) && (y0 === y1)) { 
            break 
          };

          var e2 = 2 * err;

          if (e2 > -dy) { 
            err -= dy; x0  += sx; 
          }
          if (e2 < dx) { 
            err += dx; y0  += sy; 
          }
      }
    }
    /* First getting shedevres of others (server's buffer) */
    socket.on('Your first massive', (frame) => {
      for (i = 0; i < imgData.data.length; i += 4) {
        color = frame[i / 4];
        red = parseInt(color.slice(1, 3), 16);
        green = parseInt(color.slice(3, 5), 16);
        blue = parseInt(color.slice(5, 7), 16);
        imgData.data[i+0] = red;
        imgData.data[i+1] = green;
        imgData.data[i+2] = blue;
        imgData.data[i+3] = 255;
      }
      ctx.putImageData(imgData, 0, 0);
    })
    /* Init  */    
    for (i = 0; i < imgData.data.length; i++) {
      imgData.data[i] = 255;
    }
    ctx.putImageData(imgData, 0, 0);
    /* end of init */

    msg = {
      w: globW,
      h: globB
    }
    socket.emit('Am I first to create', msg);
  </script>
</body>
</html>
